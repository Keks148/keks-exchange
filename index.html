<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>KeksSwap ‚Äî –æ–±–º–µ–Ω –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#e4f3f4" />

  <!-- –ö—Ä–∞—Å–∏–≤—ã–π –∂–∏—Ä–Ω—ã–π –∫—É—Ä—Å–∏–≤–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-gradient-from: #e4f3f4;
      --bg-gradient-to: #dff8ec;
      --card-bg: #ffffff;
      --accent: #000000;
      --accent-soft: #111111;
      --border-soft: #e3edf2;
      --text-main: #0d1a26;
      --text-muted: #7b8a99;
      --input-bg: #f4f7fb;
      --radius-xl: 24px;
      --radius-l: 18px;
      --radius-m: 14px;
      --shadow-soft: 0 18px 45px rgba(12, 43, 70, 0.12);
      --brand-green: #23b26a;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at 20% 0, var(--bg-gradient-to), var(--bg-gradient-from) 55%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .app {
      width: 100%;
      max-width: 520px;
      margin: 0 auto;
      padding: 16px 12px 24px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .header-card {
      background: transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 40px;
      padding-bottom: 6px;
      gap: 8px;
    }

    .logo-wrapper {
      width: 104px;
      height: 104px;
      border-radius: 28px;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 18px 36px rgba(0, 0, 0, 0.26);
      overflow: hidden;
    }

    .logo-wrapper img {
      width: 92px;
      height: 92px;
      border-radius: 24px;
      object-fit: cover;
      background: #cfe7ff;
    }

    .app-title {
      margin: 4px 0 0;
      font-family: "Playfair Display", system-ui, serif;
      font-weight: 700;
      font-style: italic;
      font-size: 26px;
      letter-spacing: 0.04em;
    }

    .app-subtitle {
      margin: 0;
      font-size: 14px;
      color: var(--text-muted);
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-soft);
      padding: 14px 14px 18px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .tab-nav {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      padding: 2px;
      border-radius: 999px;
      background: #eef3f7;
    }

    .tab-btn {
      border: none;
      background: transparent;
      padding: 6px 4px 8px;
      border-radius: 999px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      font-size: 11px;
      color: var(--text-muted);
      cursor: pointer;
    }

    .tab-btn span.icon {
      font-size: 16px;
      line-height: 1;
    }

    .tab-btn span.label {
      font-size: 11px;
    }

    .tab-btn.active {
      background: #ffffff;
      color: var(--accent-soft);
      box-shadow: 0 4px 9px rgba(9, 42, 68, 0.15);
    }

    .tab-btn.active span.icon {
      transform: translateY(-1px);
    }

    .section {
      display: none;
      margin-top: 4px;
    }

    .section.active {
      display: block;
    }

    .section-title {
      margin: 2px 0 8px;
      font-size: 19px;
      font-family: "Playfair Display", system-ui, serif;
      font-weight: 600;
      font-style: italic;
    }

    .section-description {
      margin: 0 0 12px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .field-group {
      margin-bottom: 10px;
    }

    .field-label {
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 4px;
      color: var(--text-muted);
    }

    .pill-label {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      background: #f3f7fb;
      font-size: 11px;
      color: #536678;
      margin-bottom: 6px;
    }

    .pill-label strong {
      font-weight: 600;
      margin-left: 4px;
    }

    .input-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    select,
    input[type="text"],
    input[type="number"],
    textarea {
      width: 100%;
      border-radius: var(--radius-m);
      border: 1px solid var(--border-soft);
      padding: 10px 11px;
      font-size: 14px;
      background: var(--input-bg);
      color: var(--text-main);
      outline: none;
      transition: border-color 0.16s ease, background-color 0.16s ease, box-shadow 0.16s ease;
      font-family: inherit;
    }

    select:focus,
    input:focus,
    textarea:focus {
      border-color: #b9d4ff;
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(36, 119, 255, 0.05);
    }

    textarea {
      min-height: 70px;
      resize: vertical;
    }

    .muted {
      font-size: 12px;
      color: var(--text-muted);
    }

    .submit-btn {
      margin-top: 8px;
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 14px 16px;
      font-size: 16px;
      font-weight: 600;
      background: #000000;
      color: #ffffff;
      cursor: pointer;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.4);
    }

    .submit-btn:active {
      transform: translateY(1px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.38);
    }

    .toast {
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      max-width: 520px;
      width: calc(100% - 38px);
      background: #000;
      color: #fff;
      border-radius: 999px;
      padding: 11px 16px;
      font-size: 13px;
      display: none;
      align-items: center;
      justify-content: center;
      text-align: center;
      z-index: 20;
    }

    .toast.show {
      display: flex;
      animation: toast-in 0.18s ease-out;
    }

    @keyframes toast-in {
      from {
        opacity: 0;
        transform: translate(-50%, 8px);
      }
      to {
        opacity: 1;
        transform: translate(-50%, 0);
      }
    }

    /* –ò—Å—Ç–æ—Ä–∏—è */
    .history-empty {
      padding: 8px 4px 4px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .history-item {
      border-radius: 16px;
      background: #f6f8fb;
      padding: 10px 12px;
      font-size: 13px;
    }

    .history-main {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 16px;
    }

    .history-line {
      font-weight: 500;
    }

    .history-status {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #e6f6ee;
      color: #187749;
      white-space: nowrap;
    }

    .history-meta {
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-muted);
    }

    /* –ü—Ä–æ—Ñ–∏–ª—å / –ü–æ–¥–¥–µ—Ä–∂–∫–∞ */

    .profile-block {
      background: #f6f8fb;
      border-radius: 18px;
      padding: 10px 12px;
      font-size: 13px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .support-actions {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 6px;
    }

    .support-btn {
      border-radius: 999px;
      border: none;
      padding: 11px 14px;
      font-size: 14px;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
    }

    .support-btn.primary {
      background: #000;
      color: #fff;
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.35);
    }

    .support-btn.secondary {
      background: #f3f7fb;
      color: var(--text-main);
    }

    .support-btn span.icon {
      font-size: 17px;
    }

    @media (max-width: 380px) {
      .card {
        border-radius: 20px;
        padding: 12px 12px 16px;
      }
      .section-title {
        font-size: 18px;
      }
      .app-title {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="header-card">
      <div class="logo-wrapper">
        <img src="logo.png" alt="KeksSwap logo">
      </div>
      <h1 class="app-title">KeksSwap</h1>
      <p class="app-subtitle">–û–±–º–µ–Ω –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç ‚Äî –ø—Ä–æ—Å—Ç–æ –∏ –ø–æ-—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏</p>
    </header>

    <main class="card">
      <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º -->
      <nav class="tab-nav">
        <button class="tab-btn active" data-target="exchange">
          <span class="icon">üîÅ</span>
          <span class="label">–û–±–º–µ–Ω</span>
        </button>
        <button class="tab-btn" data-target="history">
          <span class="icon">üìú</span>
          <span class="label">–ò—Å—Ç–æ—Ä–∏—è</span>
        </button>
        <button class="tab-btn" data-target="profile">
          <span class="icon">üë§</span>
          <span class="label">–ü—Ä–æ—Ñ–∏–ª—å</span>
        </button>
        <button class="tab-btn" data-target="support">
          <span class="icon">üí¨</span>
          <span class="label">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</span>
        </button>
      </nav>

      <!-- –†–∞–∑–¥–µ–ª: –û–ë–ú–ï–ù -->
      <section id="section-exchange" class="section active">
        <h2 class="section-title">–ë—ã—Å—Ç—Ä—ã–π –æ–±–º–µ–Ω</h2>
        <p class="section-description">
          –í—ã–±–µ—Ä–∏—Ç–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É, —Å–µ—Ç—å –∏ —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è. –ó–∞—è–≤–∫–∞ –ø—Ä–∏–¥—ë—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä—É –≤ Telegram.
        </p>

        <form id="exchange-form">
          <!-- –û—Ç–¥–∞—é -->
          <div class="field-group">
            <div class="pill-label">–û—Ç–¥–∞—é: <strong>–∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</strong></div>
            <div class="field-label">–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</div>
            <select id="send-coin" required>
              <option value="USDT">USDT</option>
              <option value="USDC">USDC</option>
              <option value="BTC">BTC</option>
              <option value="ETH">ETH</option>
              <option value="TON">TON</option>
              <option value="TRX">TRX</option>
              <option value="SOL">SOL</option>
              <option value="BNB">BNB</option>
              <option value="LTC">LTC</option>
              <option value="XRP">XRP</option>
            </select>
          </div>

          <div class="field-group input-row">
            <div>
              <div class="field-label">–°–µ—Ç—å</div>
              <select id="send-network" required>
                <option value="TRC20">TRC20</option>
                <option value="ERC20">ERC20</option>
                <option value="BEP20">BEP20</option>
                <option value="TON">TON</option>
                <option value="BTC">BTC (onchain)</option>
              </select>
            </div>
            <div>
              <div class="field-label">–°—É–º–º–∞</div>
              <input
                id="send-amount"
                type="number"
                min="0"
                step="0.01"
                placeholder="0.00"
                required
              />
            </div>
          </div>

          <!-- –ü–æ–ª—É—á–∞—é -->
          <div class="field-group">
            <div class="pill-label">–ü–æ–ª—É—á–∞—é: <strong>–∫–∞—Ä—Ç–∞ –∏–ª–∏ –∫—Ä–∏–ø—Ç–∞</strong></div>
            <div class="field-label">–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è</div>
            <select id="receive-method" required>
              <option value="card-uah">–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞ (UAH)</option>
              <option value="card-forex">–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞ (USD / EUR)</option>
              <option value="crypto">–ö—Ä–∏–ø—Ç–∞ –Ω–∞ –∫–æ—à–µ–ª—ë–∫</option>
            </select>
          </div>

          <div id="bank-row" class="field-group">
            <div class="field-label">–ë–∞–Ω–∫ (–¥–ª—è –∫–∞—Ä—Ç—ã UAH)</div>
            <select id="bank-name">
              <option value="–õ—é–±–æ–π –±–∞–Ω–∫">–õ—é–±–æ–π –±–∞–Ω–∫</option>
              <option value="Monobank">Monobank</option>
              <option value="–ü—Ä–∏–≤–∞—Ç–ë–∞–Ω–∫">–ü—Ä–∏–≤–∞—Ç–ë–∞–Ω–∫</option>
              <option value="–ü–£–ú–ë">–ü–£–ú–ë</option>
              <option value="–ê-–ë–∞–Ω–∫">–ê-–ë–∞–Ω–∫</option>
              <option value="–û—â–∞–¥–±–∞–Ω–∫">–û—â–∞–¥–±–∞–Ω–∫</option>
            </select>
          </div>

          <div id="receive-crypto-row" class="field-group" style="display:none;">
            <div class="field-label">–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è</div>
            <div class="input-row">
              <select id="receive-coin">
                <option value="USDT">USDT</option>
                <option value="USDC">USDC</option>
                <option value="BTC">BTC</option>
                <option value="ETH">ETH</option>
                <option value="TON">TON</option>
                <option value="TRX">TRX</option>
                <option value="SOL">SOL</option>
                <option value="BNB">BNB</option>
              </select>
              <select id="receive-network">
                <option value="TRC20">TRC20</option>
                <option value="ERC20">ERC20</option>
                <option value="BEP20">BEP20</option>
                <option value="TON">TON</option>
                <option value="BTC">BTC (onchain)</option>
              </select>
            </div>
          </div>

          <div class="field-group">
            <div class="field-label">–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è</div>
            <input
              id="receive-details"
              type="text"
              placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã, IBAN –∏–ª–∏ –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞"
              required
            />
          </div>

          <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
          <div class="field-group">
            <div class="field-label">–ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏</div>
            <input
              id="contact"
              type="text"
              placeholder="@username –∏–ª–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞"
              required
            />
          </div>

          <div class="field-group">
            <div class="field-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</div>
            <textarea
              id="comment"
              placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Ö–æ—á—É –ø–æ–ª—É—á–∏—Ç—å –Ω–∞ –∫–∞—Ä—Ç—É Monobank; —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –∏ —Ç.–ø."
            ></textarea>
          </div>

          <p class="muted">
            –ö—É—Ä—Å –±—É–¥–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –ø–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º—É —Ä—ã–Ω–∫—É. –ü–µ—Ä–µ–¥ –æ–±–º–µ–Ω–æ–º –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤ Telegram.
          </p>

          <button type="submit" class="submit-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
        </form>
      </section>

      <!-- –†–∞–∑–¥–µ–ª: –ò–°–¢–û–†–ò–Ø -->
      <section id="section-history" class="section">
        <h2 class="section-title">–ò—Å—Ç–æ—Ä–∏—è –∑–∞—è–≤–æ–∫</h2>
        <p class="section-description">
          –ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞—è–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∏–∑ —ç—Ç–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.
        </p>
        <div id="history-container">
          <div class="history-empty">
            –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫–∞ –ø—É—Å—Ç–∞—è. –û—Ñ–æ—Ä–º–∏—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞—è–≤–∫—É ‚Äî –∏ –æ–Ω–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å.
          </div>
        </div>
      </section>

      <!-- –†–∞–∑–¥–µ–ª: –ü–†–û–§–ò–õ–¨ -->
      <section id="section-profile" class="section">
        <h2 class="section-title">–ü—Ä–æ—Ñ–∏–ª—å</h2>
        <p class="section-description">
          –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±–µ—Ä—ë—Ç—Å—è –∏–∑ Telegram. –ù–∏—á–µ–≥–æ –ª–∏—à–Ω–µ–≥–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º.
        </p>

        <div class="profile-block">
          <div><strong id="profile-name">–ì–æ—Å—Ç—å</strong></div>
          <div id="profile-username" class="muted">–û—Ç–∫—Ä–æ–π—Ç–µ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–∑ Telegram, —á—Ç–æ–±—ã –ø–æ–¥—Ç—è–Ω—É—Ç—å username.</div>
          <div class="muted" style="margin-top:6px;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞—è–≤–∫–∞–º –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:</div>
          <div id="profile-stats" style="font-size:13px;margin-top:2px;">
            –ó–∞—è–≤–æ–∫: 0 ¬∑ –ü–æ—Å–ª–µ–¥–Ω—è—è: ‚Äî 
          </div>
        </div>
      </section>

      <!-- –†–∞–∑–¥–µ–ª: –ü–û–î–î–ï–†–ñ–ö–ê -->
      <section id="section-support" class="section">
        <h2 class="section-title">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
        <p class="section-description">
          –ï—Å–ª–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∫—É—Ä—Å—É, —Å—É–º–º–µ –∏–ª–∏ –≤—Å—Ç—Ä–µ—á–µ ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
        </p>

        <div class="profile-block">
          <div>–û–ø–µ—Ä–∞—Ç–æ—Ä: <strong>@KeksSwapSupport</strong></div>
          <div class="muted">
            –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –æ–±—ã—á–Ω–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 5‚Äì15 –º–∏–Ω—É—Ç. –ï—Å–ª–∏ –∑–∞—è–≤–∫–∞ —Å—Ä–æ—á–Ω–∞—è ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã.
          </div>

          <div class="support-actions">
            <button type="button" class="support-btn primary" id="support-open-chat">
              <span class="icon">üí¨</span>
              <span>–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç –≤ Telegram</span>
            </button>
            <button type="button" class="support-btn secondary" id="support-copy">
              <span class="icon">üìã</span>
              <span>–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å @KeksSwapSupport</span>
            </button>
          </div>
        </div>
      </section>
    </main>

    <div id="toast" class="toast"></div>
  </div>

  <script>
    // --- Telegram WebApp init (–µ—Å–ª–∏ –µ—Å—Ç—å) ---
    const tg = window.Telegram ? window.Telegram.WebApp : null;
    if (tg) {
      tg.expand && tg.expand();
      tg.ready && tg.ready();
    }

    // --- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º ---
    const sections = document.querySelectorAll(".section");
    const tabButtons = document.querySelectorAll(".tab-btn");

    tabButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.dataset.target; // exchange / history / profile / support
        sections.forEach(sec => {
          sec.classList.toggle("active", sec.id === "section-" + target);
        });
        tabButtons.forEach(b => b.classList.toggle("active", b === btn));
      });
    });

    // --- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∞ –ø–æ–ª—É—á–µ–Ω–∏—è ---
    const receiveMethodSelect = document.getElementById("receive-method");
    const bankRow = document.getElementById("bank-row");
    const receiveCryptoRow = document.getElementById("receive-crypto-row");

    function updateReceiveVisibility() {
      const method = receiveMethodSelect.value;
      if (method === "card-uah") {
        bankRow.style.display = "";
        receiveCryptoRow.style.display = "none";
      } else if (method === "crypto") {
        bankRow.style.display = "none";
        receiveCryptoRow.style.display = "";
      } else {
        // card-forex
        bankRow.style.display = "none";
        receiveCryptoRow.style.display = "none";
      }
    }
    receiveMethodSelect.addEventListener("change", updateReceiveVisibility);
    updateReceiveVisibility();

    // --- –ò—Å—Ç–æ—Ä–∏—è –∑–∞—è–≤–æ–∫ ---
    const HISTORY_KEY = "keksswap_history_v1";
    const historyContainer = document.getElementById("history-container");
    const profileStats = document.getElementById("profile-stats");

    function loadHistory() {
      try {
        return JSON.parse(localStorage.getItem(HISTORY_KEY) || "[]");
      } catch (e) {
        return [];
      }
    }

    function saveHistory(list) {
      try {
        localStorage.setItem(HISTORY_KEY, JSON.stringify(list.slice(0, 30)));
      } catch (e) {}
    }

    function renderHistory() {
      const history = loadHistory();
      if (!history.length) {
        historyContainer.innerHTML =
          '<div class="history-empty">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫–∞ –ø—É—Å—Ç–∞—è. –û—Ñ–æ—Ä–º–∏—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞—è–≤–∫—É ‚Äî –∏ –æ–Ω–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å.</div>';
      } else {
        historyContainer.innerHTML =
          '<div class="history-list">' +
          history
            .map(item => {
              const date = new Date(item.createdAt);
              const dateStr = date.toLocaleString();
              const line =
                item.sendAmount +
                " " +
                item.sendCoin +
                " ‚Üí " +
                item.receiveSummary;
              return (
                '<div class="history-item">' +
                  '<div class="history-main">' +
                    '<div class="history-line">' + line + "</div>" +
                    '<div class="history-status">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</div>' +
                  "</div>" +
                  '<div class="history-meta">' + dateStr + "</div>" +
                "</div>"
              );
            })
            .join("") +
          "</div>";
      }

      // –û–±–Ω–æ–≤–∏—Ç—å –±–ª–æ–∫ –ü—Ä–æ—Ñ–∏–ª—å
      const count = history.length;
      if (!count) {
        profileStats.textContent = "–ó–∞—è–≤–æ–∫: 0 ¬∑ –ü–æ—Å–ª–µ–¥–Ω—è—è: ‚Äî";
      } else {
        const last = new Date(history[0].createdAt).toLocaleString();
        profileStats.textContent = "–ó–∞—è–≤–æ–∫: " + count + " ¬∑ –ü–æ—Å–ª–µ–¥–Ω—è—è: " + last;
      }
    }

    renderHistory();

    // --- –ü—Ä–æ—Ñ–∏–ª—å –∏–∑ Telegram ---
    const profileNameEl = document.getElementById("profile-name");
    const profileUsernameEl = document.getElementById("profile-username");
    const contactInput = document.getElementById("contact");

    if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
      const u = tg.initDataUnsafe.user;
      const fullName = [u.first_name, u.last_name].filter(Boolean).join(" ");
      if (fullName) profileNameEl.textContent = fullName;
      if (u.username) {
        const uname = "@" + u.username;
        profileUsernameEl.textContent = uname;
        profileUsernameEl.classList.remove("muted");
        if (!contactInput.value) contactInput.value = uname;
      } else {
        profileUsernameEl.textContent = "Username –≤ Telegram –Ω–µ –∑–∞–¥–∞–Ω.";
      }
    }

    // --- –¢–æ—Å—Ç ---
    const toastEl = document.getElementById("toast");
    let toastTimeout = null;

    function showToast(text) {
      toastEl.textContent = text;
      toastEl.classList.add("show");
      if (toastTimeout) clearTimeout(toastTimeout);
      toastTimeout = setTimeout(() => {
        toastEl.classList.remove("show");
      }, 2600);
    }

    // --- –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã ---
    const form = document.getElementById("exchange-form");

    form.addEventListener("submit", (e) => {
      e.preventDefault();

      const sendCoin = document.getElementById("send-coin").value;
      const sendNetwork = document.getElementById("send-network").value;
      const sendAmount = document.getElementById("send-amount").value.trim();
      const receiveMethod = receiveMethodSelect.value;
      const bankName = document.getElementById("bank-name").value;
      const receiveCoin = document.getElementById("receive-coin").value;
      const receiveNetwork = document.getElementById("receive-network").value;
      const receiveDetails = document.getElementById("receive-details").value.trim();
      const contact = contactInput.value.trim();
      const comment = document.getElementById("comment").value.trim();

      if (!sendAmount || Number(sendAmount) <= 0) {
        showToast("–£–∫–∞–∂–∏ —Å—É–º–º—É –æ–±–º–µ–Ω–∞.");
        return;
      }
      if (!receiveDetails) {
        showToast("–£–∫–∞–∂–∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è.");
        return;
      }
      if (!contact) {
        showToast("–£–∫–∞–∂–∏ –∫–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏.");
        return;
      }

      let receiveSummary = "";
      if (receiveMethod === "card-uah") {
        receiveSummary = "–ö–∞—Ä—Ç–∞ UAH (" + bankName + ")";
      } else if (receiveMethod === "card-forex") {
        receiveSummary = "–ö–∞—Ä—Ç–∞ USD/EUR";
      } else {
        receiveSummary = "–ö—Ä–∏–ø—Ç–∞ " + receiveCoin + " (" + receiveNetwork + ")";
      }

      const order = {
        sendCoin,
        sendNetwork,
        sendAmount,
        receiveMethod,
        bankName,
        receiveCoin,
        receiveNetwork,
        receiveDetails,
        contact,
        comment,
        receiveSummary,
        createdAt: new Date().toISOString()
      };

      // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
      if (tg && tg.sendData) {
        try {
          tg.sendData(JSON.stringify(order));
          if (tg.HapticFeedback && tg.HapticFeedback.notificationOccurred) {
            tg.HapticFeedback.notificationOccurred("success");
          }
        } catch (err) {
          console.error("Telegram sendData error", err);
        }
      }

      // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é
      const history = loadHistory();
      history.unshift(order);
      saveHistory(history);
      renderHistory();

      showToast("‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É –≤ Telegram");
      form.reset();
      updateReceiveVisibility();
    });

    // --- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ---
    const SUPPORT_LINK = "https://t.me/KeksSwapSupport";

    document.getElementById("support-open-chat").addEventListener("click", () => {
      if (tg && tg.openTelegramLink) {
        tg.openTelegramLink(SUPPORT_LINK);
      } else {
        window.open(SUPPORT_LINK, "_blank");
      }
    });

    document.getElementById("support-copy").addEventListener("click", async () => {
      const text = "@KeksSwapSupport";
      try {
        await navigator.clipboard.writeText(text);
        showToast("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: " + text);
      } catch (e) {
        showToast(text);
      }
    });
  </script>
</body>
</html>
