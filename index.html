<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>KeksSwap — обмен криптовалют</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#e4f3f4" />

  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-gradient-from: #e4f3f4;
      --bg-gradient-to: #dff8ec;
      --card-bg: #ffffff;
      --accent: #000000;
      --accent-soft: #111111;
      --border-soft: #e3edf2;
      --text-main: #0d1a26;
      --text-muted: #7b8a99;
      --input-bg: #f4f7fb;
      --radius-xl: 24px;
      --radius-m: 14px;
      --shadow-soft: 0 18px 45px rgba(12, 43, 70, 0.12);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at 20% 0, var(--bg-gradient-to), var(--bg-gradient-from) 55%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .app {
      width: 100%;
      max-width: 520px;
      margin: 0 auto;
      padding: 16px 12px 24px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .header-card {
      background: transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 28px;
      padding-bottom: 6px;
      gap: 8px;
    }

    .logo-wrapper {
      width: 96px;
      height: 96px;
      border-radius: 26px;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 14px 32px rgba(0, 0, 0, 0.28);
      overflow: hidden;
    }

    .logo-wrapper img {
      width: 86px;
      height: 86px;
      border-radius: 22px;
      object-fit: cover;
      background: #cfe7ff;
    }

    .app-title {
      margin: 6px 0 0;
      font-family: "Playfair Display", system-ui, serif;
      font-weight: 700;
      font-style: italic;
      font-size: 26px;
      letter-spacing: 0.04em;
    }

    .app-subtitle {
      margin: 0;
      font-size: 14px;
      color: var(--text-muted);
      text-align: center;
    }

    .lang-switch {
      margin-top: 6px;
      display: inline-flex;
      gap: 4px;
      padding: 3px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.7);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.12);
    }

    .lang-btn {
      border: none;
      background: transparent;
      border-radius: 999px;
      padding: 3px 8px;
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      cursor: pointer;
      color: #555;
    }

    .lang-btn.active {
      background: #000;
      color: #fff;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-soft);
      padding: 14px 14px 18px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .tab-nav {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      padding: 2px;
      border-radius: 999px;
      background: #eef3f7;
    }

    .tab-btn {
      border: none;
      background: transparent;
      padding: 6px 4px 8px;
      border-radius: 999px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      font-size: 11px;
      color: var(--text-muted);
      cursor: pointer;
    }

    .tab-btn span.icon {
      font-size: 16px;
      line-height: 1;
    }

    .tab-btn span.label {
      font-size: 11px;
    }

    .tab-btn.active {
      background: #ffffff;
      color: var(--accent-soft);
      box-shadow: 0 4px 9px rgba(9, 42, 68, 0.15);
    }

    .tab-btn.active span.icon {
      transform: translateY(-1px);
    }

    .section {
      display: none;
      margin-top: 4px;
    }

    .section.active {
      display: block;
    }

    .section-title {
      margin: 2px 0 8px;
      font-size: 19px;
      font-family: "Playfair Display", system-ui, serif;
      font-weight: 600;
      font-style: italic;
    }

    .section-description {
      margin: 0 0 12px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .field-group {
      margin-bottom: 10px;
    }

    .field-label {
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 4px;
      color: var(--text-muted);
    }

    .pill-label {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      background: #f3f7fb;
      font-size: 11px;
      color: #536678;
      margin-bottom: 6px;
    }

    .input-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    select,
    input[type="text"],
    input[type="number"],
    textarea {
      width: 100%;
      border-radius: var(--radius-m);
      border: 1px solid var(--border-soft);
      padding: 10px 11px;
      font-size: 14px;
      background: var(--input-bg);
      color: var(--text-main);
      outline: none;
      transition: border-color 0.16s ease, background-color 0.16s ease, box-shadow 0.16s ease;
      font-family: inherit;
    }

    select:focus,
    input:focus,
    textarea:focus {
      border-color: #b9d4ff;
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(36, 119, 255, 0.05);
    }

    textarea {
      min-height: 70px;
      resize: vertical;
    }

    .muted {
      font-size: 12px;
      color: var(--text-muted);
    }

    .submit-btn {
      margin-top: 8px;
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 14px 16px;
      font-size: 16px;
      font-weight: 600;
      background: #000000;
      color: #ffffff;
      cursor: pointer;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.4);
    }

    .submit-btn:active {
      transform: translateY(1px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.38);
    }

    .toast {
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      max-width: 520px;
      width: calc(100% - 38px);
      background: #000;
      color: #fff;
      border-radius: 999px;
      padding: 11px 16px;
      font-size: 13px;
      display: none;
      align-items: center;
      justify-content: center;
      text-align: center;
      z-index: 20;
    }

    .toast.show {
      display: flex;
      animation: toast-in 0.18s ease-out;
    }

    @keyframes toast-in {
      from {
        opacity: 0;
        transform: translate(-50%, 8px);
      }
      to {
        opacity: 1;
        transform: translate(-50%, 0);
      }
    }

    .history-empty {
      padding: 8px 4px 4px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .history-item {
      border-radius: 16px;
      background: #f6f8fb;
      padding: 10px 12px;
      font-size: 13px;
    }

    .history-main {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 16px;
    }

    .history-line {
      font-weight: 500;
    }

    .history-status {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #e6f6ee;
      color: #187749;
      white-space: nowrap;
    }

    .history-meta {
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .profile-block {
      background: #f6f8fb;
      border-radius: 18px;
      padding: 10px 12px;
      font-size: 13px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .support-actions {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 6px;
    }

    .support-btn {
      border-radius: 999px;
      border: none;
      padding: 11px 14px;
      font-size: 14px;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
    }

    .support-btn.primary {
      background: #000;
      color: #fff;
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.35);
    }

    .support-btn.secondary {
      background: #f3f7fb;
      color: var(--text-main);
    }

    .support-btn span.icon {
      font-size: 17px;
    }

    @media (max-width: 380px) {
      .card {
        border-radius: 20px;
        padding: 12px 12px 16px;
      }
      .section-title {
        font-size: 18px;
      }
      .app-title {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="header-card">
      <div class="logo-wrapper">
        <img src="logo.png" alt="KeksSwap logo">
      </div>
      <h1 class="app-title">KeksSwap</h1>
      <p class="app-subtitle" data-i18n="subtitle"></p>

      <div class="lang-switch">
        <button class="lang-btn" data-lang="ru">RU</button>
        <button class="lang-btn" data-lang="uk">UA</button>
        <button class="lang-btn" data-lang="en">EN</button>
        <button class="lang-btn" data-lang="pl">PL</button>
      </div>
    </header>

    <main class="card">
      <nav class="tab-nav">
        <button class="tab-btn active" data-target="exchange">
          <span class="icon">⇄</span>
          <span class="label" data-i18n="tab-exchange"></span>
        </button>
        <button class="tab-btn" data-target="history">
          <span class="icon">☷</span>
          <span class="label" data-i18n="tab-history"></span>
        </button>
        <button class="tab-btn" data-target="profile">
          <span class="icon">◎</span>
          <span class="label" data-i18n="tab-profile"></span>
        </button>
        <button class="tab-btn" data-target="support">
          <span class="icon">❍</span>
          <span class="label" data-i18n="tab-support"></span>
        </button>
      </nav>

      <section id="section-exchange" class="section active">
        <h2 class="section-title" data-i18n="title-exchange"></h2>
        <p class="section-description" data-i18n="desc-exchange"></p>

        <form id="exchange-form">
          <div class="field-group">
            <div class="pill-label" data-i18n="pill-send"></div>
            <div class="field-label" data-i18n="label-send-asset"></div>
            <select id="send-asset" required>
              <option value="card-uah" data-i18n-opt="opt-send-card-uah"></option>
              <option value="USDT">USDT</option>
              <option value="USDC">USDC</option>
              <option value="BTC">BTC</option>
              <option value="ETH">ETH</option>
              <option value="TON">TON</option>
              <option value="TRX">TRX</option>
              <option value="SOL">SOL</option>
              <option value="BNB">BNB</option>
              <option value="LTC">LTC</option>
              <option value="XRP">XRP</option>
            </select>
          </div>

          <div class="field-group">
            <div class="input-row">
              <div id="send-network-col">
                <div class="field-label" data-i18n="label-network"></div>
                <select id="send-network" required>
                  <option value="TRC20">TRC20</option>
                  <option value="ERC20">ERC20</option>
                  <option value="BEP20">BEP20</option>
                  <option value="TON">TON</option>
                  <option value="BTC">BTC (onchain)</option>
                </select>
              </div>
              <div>
                <div class="field-label" data-i18n="label-amount"></div>
                <input
                  id="send-amount"
                  type="number"
                  min="0"
                  step="0.01"
                  data-i18n-placeholder="placeholder-send-amount"
                  required
                />
              </div>
            </div>
          </div>

          <div class="field-group">
            <div class="pill-label" data-i18n="pill-receive"></div>
            <div class="field-label" data-i18n="label-receive-asset"></div>
            <select id="receive-asset" required>
              <option value="card-uah" data-i18n-opt="opt-receive-card-uah"></option>
              <option value="requisites-uah" data-i18n-opt="opt-receive-requisites-uah"></option>
              <option value="card-forex" data-i18n-opt="opt-receive-card-forex"></option>
              <option value="USDT">USDT</option>
              <option value="USDC">USDC</option>
              <option value="BTC">BTC</option>
              <option value="ETH">ETH</option>
              <option value="TON">TON</option>
              <option value="TRX">TRX</option>
              <option value="SOL">SOL</option>
              <option value="BNB">BNB</option>
              <option value="LTC">LTC</option>
              <option value="XRP">XRP</option>
            </select>
          </div>

          <div id="bank-row" class="field-group">
            <div class="field-label" data-i18n="label-bank"></div>
            <select id="bank-name">
              <option value="any" data-i18n-opt="opt-any-bank"></option>
              <option value="Monobank">Monobank</option>
              <option value="ПриватБанк">ПриватБанк</option>
              <option value="ПУМБ">ПУМБ</option>
              <option value="А-Банк">А-Банк</option>
              <option value="Ощадбанк">Ощадбанк</option>
            </select>
          </div>

          <div id="receive-network-row" class="field-group" style="display:none;">
            <div class="field-label" data-i18n="label-receive-network"></div>
            <select id="receive-network">
              <option value="TRC20">TRC20</option>
              <option value="ERC20">ERC20</option>
              <option value="BEP20">BEP20</option>
              <option value="TON">TON</option>
              <option value="BTC">BTC (onchain)</option>
            </select>
          </div>

          <div class="field-group">
            <div class="field-label" data-i18n="label-receive-details"></div>
            <input
              id="receive-details"
              type="text"
              data-i18n-placeholder="placeholder-receive-details"
              required
            />
          </div>

          <div class="field-group">
            <div class="field-label" data-i18n="label-contact"></div>
            <input
              id="contact"
              type="text"
              data-i18n-placeholder="placeholder-contact"
              required
            />
          </div>

          <div class="field-group">
            <div class="field-label" data-i18n="label-comment"></div>
            <textarea
              id="comment"
              data-i18n-placeholder="placeholder-comment"
            ></textarea>
          </div>

          <p class="muted" data-i18n="muted-exchange-note"></p>

          <button type="submit" class="submit-btn" data-i18n="btn-submit"></button>
        </form>
      </section>

      <section id="section-history" class="section">
        <h2 class="section-title" data-i18n="history-title"></h2>
        <p class="section-description" data-i18n="history-desc"></p>
        <div id="history-container"></div>
      </section>

      <section id="section-profile" class="section">
        <h2 class="section-title" data-i18n="profile-title"></h2>
        <p class="section-description" data-i18n="profile-desc"></p>

        <div class="profile-block">
          <div><strong id="profile-name">Гость</strong></div>
          <div id="profile-username" class="muted"></div>
          <div class="muted" style="margin-top:6px;" data-i18n="profile-stats-label"></div>
          <div id="profile-stats" style="font-size:13px;margin-top:2px;"></div>
        </div>
      </section>

      <section id="section-support" class="section">
        <h2 class="section-title" data-i18n="support-title"></h2>
        <p class="section-description" data-i18n="support-desc"></p>

        <div class="profile-block">
          <div id="support-operator" data-i18n="support-operator-line"></div>
          <div class="muted" style="margin-top:4px;" data-i18n="support-time"></div>

          <div class="support-actions">
            <button type="button" class="support-btn primary" id="support-open-chat">
              <span class="icon">❍</span>
              <span data-i18n="support-open-btn"></span>
            </button>
            <button type="button" class="support-btn secondary" id="support-copy">
              <span class="icon">▣</span>
              <span data-i18n="support-copy-btn"></span>
            </button>
          </div>
        </div>
      </section>
    </main>

    <div id="toast" class="toast"></div>
  </div>

  <script>
    const tg = window.Telegram ? window.Telegram.WebApp : null;
    if (tg) {
      tg.expand && tg.expand();
      tg.ready && tg.ready();
    }

    const translations = {
      ru: {
        subtitle: "Обмен криптовалют — просто и по-человечески",
        "tab-exchange": "Обмен",
        "tab-history": "История",
        "tab-profile": "Профиль",
        "tab-support": "Поддержка",

        "title-exchange": "Быстрый обмен",
        "desc-exchange": "Выберите, что отдаёте и что хотите получить. Заявка придёт оператору в Telegram.",
        "pill-send": "Отдаю: крипта или карта",
        "pill-receive": "Получаю: карта / реквизиты / крипта",
        "label-send-asset": "Актив для оплаты",
        "label-network": "Сеть",
        "label-amount": "Сумма",
        "label-receive-asset": "Что хотите получить",
        "label-bank": "Банк (для карты)",
        "label-receive-network": "Сеть для получения",
        "label-receive-details": "Реквизиты для получения",
        "label-contact": "Контакт для связи",
        "label-comment": "Комментарий (необязательно)",

        "placeholder-send-amount": "0.00",
        "placeholder-receive-details": "Номер карты, IBAN или адрес кошелька",
        "placeholder-contact": "@username или номер телефона",
        "placeholder-comment": "Например: хочу оплатить картой UAH; удобное время и т.п.",

        "muted-exchange-note": "Курс будет рассчитан оператором по актуальному рынку. Перед обменом вы получите подтверждение в Telegram.",

        "btn-submit": "Отправить заявку",

        "history-title": "История заявок",
        "history-desc": "Здесь будут последние заявки, которые вы отправили из этого устройства.",
        "history-empty": "История пока пустая. Оформите первую заявку — и она появится здесь.",
        "history-status-sent": "Отправлено",

        "profile-title": "Профиль",
        "profile-desc": "Информация берётся из Telegram. Ничего лишнего не сохраняем.",
        "profile-username-missing": "Username в Telegram не задан.",
        "profile-stats-empty": "Заявок: 0 · Последняя: —",
        "profile-stats-template": "Заявок: {count} · Последняя: {last}",

        "support-title": "Поддержка",
        "support-desc": "Если появились вопросы по курсу, сумме или расчёту — напишите оператору или скопируйте контакт.",
        "support-operator-line": "Оператор: @KeksSwapSupport",
        "support-time": "Время ответа обычно в пределах 5–15 минут. Если заявка срочная — напишите сразу после отправки формы.",
        "support-open-btn": "Открыть чат в Telegram",
        "support-copy-btn": "Скопировать @KeksSwapSupport",

        "toast-copied": "Скопировано: @KeksSwapSupport",
        "toast-sent": "✅ Заявка отправлена оператору в Telegram",
        "err-amount": "Укажи сумму обмена.",
        "err-receive-details": "Укажи реквизиты для получения.",
        "err-contact": "Укажи контакт для связи.",

        "opt-send-card-uah": "Карта UAH",
        "opt-receive-card-uah": "Карта UAH (Visa / MasterCard)",
        "opt-receive-requisites-uah": "Перевод по реквизитам (UAH)",
        "opt-receive-card-forex": "Карта USD / EUR",
        "opt-any-bank": "Любой банк",

        "sum-card-uah": "Карта UAH ({bank})",
        "sum-requisites-uah": "Реквизиты UAH",
        "sum-card-forex": "Карта USD/EUR ({bank})",
        "sum-crypto-template": "Крипта {asset}{network}"
      },

      uk: {
        subtitle: "Обмін криптовалют — просто й по-людськи",
        "tab-exchange": "Обмін",
        "tab-history": "Історія",
        "tab-profile": "Профіль",
        "tab-support": "Підтримка",

        "title-exchange": "Швидкий обмін",
        "desc-exchange": "Оберіть, що віддаєте та що хочете отримати. Заявка прийде оператору в Telegram.",
        "pill-send": "Віддаю: крипта або картка",
        "pill-receive": "Отримую: картка / реквізити / крипта",
        "label-send-asset": "Актив для оплати",
        "label-network": "Мережа",
        "label-amount": "Сума",
        "label-receive-asset": "Що хочете отримати",
        "label-bank": "Банк (для картки)",
        "label-receive-network": "Мережа для отримання",
        "label-receive-details": "Реквізити для отримання",
        "label-contact": "Контакт для звʼязку",
        "label-comment": "Коментар (необовʼязково)",

        "placeholder-send-amount": "0.00",
        "placeholder-receive-details": "Номер картки, IBAN або адреса гаманця",
        "placeholder-contact": "@username або номер телефону",
        "placeholder-comment": "Наприклад: хочу оплатити карткою UAH; зручний час тощо.",

        "muted-exchange-note": "Курс розрахує оператор за актуальним ринком. Перед обміном ви отримаєте підтвердження в Telegram.",

        "btn-submit": "Надіслати заявку",

        "history-title": "Історія заявок",
        "history-desc": "Тут будуть останні заявки, які ви надсилали з цього пристрою.",
        "history-empty": "Історія поки порожня. Створіть першу заявку — і вона зʼявиться тут.",
        "history-status-sent": "Надіслано",

        "profile-title": "Профіль",
        "profile-desc": "Інформація береться з Telegram. Нічого зайвого не зберігаємо.",
        "profile-username-missing": "Username в Telegram не вказано.",
        "profile-stats-empty": "Заявок: 0 · Остання: —",
        "profile-stats-template": "Заявок: {count} · Остання: {last}",

        "support-title": "Підтримка",
        "support-desc": "Якщо є запитання щодо курсу, суми чи розрахунку — напишіть оператору або скопіюйте контакт.",
        "support-operator-line": "Оператор: @KeksSwapSupport",
        "support-time": "Зазвичай відповідаємо протягом 5–15 хвилин. Якщо заявка термінова — напишіть одразу після відправки форми.",
        "support-open-btn": "Відкрити чат у Telegram",
        "support-copy-btn": "Скопіювати @KeksSwapSupport",

        "toast-copied": "Скопійовано: @KeksSwapSupport",
        "toast-sent": "✅ Заявку надіслано оператору в Telegram",
        "err-amount": "Вкажіть суму обміну.",
        "err-receive-details": "Вкажіть реквізити для отримання.",
        "err-contact": "Вкажіть контакт для звʼязку.",

        "opt-send-card-uah": "Картка UAH",
        "opt-receive-card-uah": "Картка UAH (Visa / MasterCard)",
        "opt-receive-requisites-uah": "Переказ за реквізитами (UAH)",
        "opt-receive-card-forex": "Картка USD / EUR",
        "opt-any-bank": "Будь-який банк",

        "sum-card-uah": "Картка UAH ({bank})",
        "sum-requisites-uah": "Реквізити UAH",
        "sum-card-forex": "Картка USD/EUR ({bank})",
        "sum-crypto-template": "Крипта {asset}{network}"
      },

      en: {
        subtitle: "Crypto exchange — simple and human",
        "tab-exchange": "Exchange",
        "tab-history": "History",
        "tab-profile": "Profile",
        "tab-support": "Support",

        "title-exchange": "Quick exchange",
        "desc-exchange": "Choose what you send and what you want to receive. The request will be sent to the operator in Telegram.",
        "pill-send": "Send: crypto or card",
        "pill-receive": "Receive: card / details / crypto",
        "label-send-asset": "Asset to pay with",
        "label-network": "Network",
        "label-amount": "Amount",
        "label-receive-asset": "What you want to receive",
        "label-bank": "Bank (for card)",
        "label-receive-network": "Network to receive on",
        "label-receive-details": "Details to receive",
        "label-contact": "Contact",
        "label-comment": "Comment (optional)",

        "placeholder-send-amount": "0.00",
        "placeholder-receive-details": "Card number, IBAN or wallet address",
        "placeholder-contact": "@username or phone number",
        "placeholder-comment": "For example: want to receive to UAH card; convenient time, etc.",

        "muted-exchange-note": "The rate will be calculated by the operator at the current market price. You will get confirmation in Telegram before the exchange.",

        "btn-submit": "Send request",

        "history-title": "Request history",
        "history-desc": "Here you will see the last requests sent from this device.",
        "history-empty": "History is empty for now. Create your first request and it will appear here.",
        "history-status-sent": "Sent",

        "profile-title": "Profile",
        "profile-desc": "Information is taken from Telegram. We do not store anything extra.",
        "profile-username-missing": "Telegram username is not set.",
        "profile-stats-empty": "Requests: 0 · Last: —",
        "profile-stats-template": "Requests: {count} · Last: {last}",

        "support-title": "Support",
        "support-desc": "If you have questions about the rate, amount or calculation — write to the operator or copy the contact.",
        "support-operator-line": "Operator: @KeksSwapSupport",
        "support-time": "Typical reply time is 5–15 minutes. If your request is urgent, write right after sending the form.",
        "support-open-btn": "Open chat in Telegram",
        "support-copy-btn": "Copy @KeksSwapSupport",

        "toast-copied": "Copied: @KeksSwapSupport",
        "toast-sent": "✅ Request sent to the operator in Telegram",
        "err-amount": "Enter the amount to exchange.",
        "err-receive-details": "Enter details to receive funds.",
        "err-contact": "Enter a contact for communication.",

        "opt-send-card-uah": "Card UAH",
        "opt-receive-card-uah": "Card UAH (Visa / MasterCard)",
        "opt-receive-requisites-uah": "Transfer by bank details (UAH)",
        "opt-receive-card-forex": "Card USD / EUR",
        "opt-any-bank": "Any bank",

        "sum-card-uah": "Card UAH ({bank})",
        "sum-requisites-uah": "Bank details UAH",
        "sum-card-forex": "Card USD/EUR ({bank})",
        "sum-crypto-template": "Crypto {asset}{network}"
      },

      pl: {
        subtitle: "Wymiana kryptowalut — prosto i po ludzku",
        "tab-exchange": "Wymiana",
        "tab-history": "Historia",
        "tab-profile": "Profil",
        "tab-support": "Wsparcie",

        "title-exchange": "Szybka wymiana",
        "desc-exchange": "Wybierz co wysyłasz i co chcesz otrzymać. Zlecenie trafi do operatora w Telegramie.",
        "pill-send": "Wysyłam: krypto lub karta",
        "pill-receive": "Otrzymuję: karta / dane / krypto",
        "label-send-asset": "Aktyw do zapłaty",
        "label-network": "Sieć",
        "label-amount": "Kwota",
        "label-receive-asset": "Co chcesz otrzymać",
        "label-bank": "Bank (dla karty)",
        "label-receive-network": "Sieć do odbioru",
        "label-receive-details": "Dane do odbioru",
        "label-contact": "Kontakt",
        "label-comment": "Komentarz (opcjonalnie)",

        "placeholder-send-amount": "0.00",
        "placeholder-receive-details": "Numer karty, IBAN lub adres portfela",
        "placeholder-contact": "@username lub numer telefonu",
        "placeholder-comment": "Np.: chcę otrzymać na kartę UAH; wygodna godzina itd.",

        "muted-exchange-note": "Kurs obliczy operator po aktualnym rynku. Przed wymianą otrzymasz potwierdzenie w Telegramie.",

        "btn-submit": "Wyślij zlecenie",

        "history-title": "Historia zleceń",
        "history-desc": "Tutaj pojawią się ostatnie zlecenia wysłane z tego urządzenia.",
        "history-empty": "Historia jest na razie pusta. Utwórz pierwsze zlecenie, a pojawi się tutaj.",
        "history-status-sent": "Wysłano",

        "profile-title": "Profil",
        "profile-desc": "Informacje pobierane są z Telegrama. Nie przechowujemy niczego zbędnego.",
        "profile-username-missing": "Nazwa użytkownika Telegram nie jest ustawiona.",
        "profile-stats-empty": "Zleceń: 0 · Ostatnie: —",
        "profile-stats-template": "Zleceń: {count} · Ostatnie: {last}",

        "support-title": "Wsparcie",
        "support-desc": "Masz pytania o kurs, kwotę lub rozliczenie? Napisz do operatora lub skopiuj kontakt.",
        "support-operator-line": "Operator: @KeksSwapSupport",
        "support-time": "Zwykle odpowiadamy w ciągu 5–15 minut. Jeśli zlecenie jest pilne — napisz od razu po wysłaniu formularza.",
        "support-open-btn": "Otwórz czat w Telegramie",
        "support-copy-btn": "Skopiuj @KeksSwapSupport",

        "toast-copied": "Skopiowano: @KeksSwapSupport",
        "toast-sent": "✅ Zlecenie wysłane do operatora w Telegramie",
        "err-amount": "Podaj kwotę wymiany.",
        "err-receive-details": "Podaj dane do odbioru.",
        "err-contact": "Podaj kontakt.",

        "opt-send-card-uah": "Karta UAH",
        "opt-receive-card-uah": "Karta UAH (Visa / MasterCard)",
        "opt-receive-requisites-uah": "Przelew na dane (UAH)",
        "opt-receive-card-forex": "Karta USD / EUR",
        "opt-any-bank": "Dowolny bank",

        "sum-card-uah": "Karta UAH ({bank})",
        "sum-requisites-uah": "Dane bankowe UAH",
        "sum-card-forex": "Karta USD/EUR ({bank})",
        "sum-crypto-template": "Krypto {asset}{network}"
      }
    };

    let currentLang = localStorage.getItem("keksswap_lang") || "ru";

    function t(key) {
      const dict = translations[currentLang] || translations["ru"];
      return dict[key] || translations["ru"][key] || key;
    }

    function applyTranslations(lang) {
      currentLang = lang;
      localStorage.setItem("keksswap_lang", lang);

      document.querySelectorAll(".lang-btn").forEach((btn) => {
        btn.classList.toggle("active", btn.dataset.lang === currentLang);
      });

      document.querySelectorAll("[data-i18n]").forEach((el) => {
        el.textContent = t(el.dataset.i18n);
      });

      document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
        el.placeholder = t(el.dataset.i18nPlaceholder);
      });

      document.querySelectorAll("[data-i18n-opt]").forEach((opt) => {
        opt.textContent = t(opt.dataset.i18nOpt);
      });

      updateProfileTexts();
      renderHistory();
    }

    const sections = document.querySelectorAll(".section");
    const tabButtons = document.querySelectorAll(".tab-btn");

    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const target = btn.dataset.target;
        sections.forEach((sec) => {
          sec.classList.toggle("active", sec.id === "section-" + target);
        });
        tabButtons.forEach((b) => b.classList.toggle("active", b === btn));
      });
    });

    document.querySelectorAll(".lang-btn").forEach((btn) => {
      btn.addEventListener("click", () => applyTranslations(btn.dataset.lang));
    });

    const receiveAssetSelect = document.getElementById("receive-asset");
    const bankRow = document.getElementById("bank-row");
    const receiveNetworkRow = document.getElementById("receive-network-row");
    const receiveNetworkSelect = document.getElementById("receive-network");
    const CRYPTO_VALUES = ["USDT","USDC","BTC","ETH","TON","TRX","SOL","BNB","LTC","XRP"];

    function updateReceiveVisibility() {
      const asset = receiveAssetSelect.value;
      if (asset === "card-uah" || asset === "card-forex") {
        bankRow.style.display = "";
        receiveNetworkRow.style.display = "none";
      } else if (asset === "requisites-uah") {
        bankRow.style.display = "none";
        receiveNetworkRow.style.display = "none";
      } else if (CRYPTO_VALUES.includes(asset)) {
        bankRow.style.display = "none";
        receiveNetworkRow.style.display = "";
      }
    }
    receiveAssetSelect.addEventListener("change", updateReceiveVisibility);
    updateReceiveVisibility();

    const sendAssetSelect = document.getElementById("send-asset");
    const sendNetworkCol = document.getElementById("send-network-col");
    const sendNetworkSelect = document.getElementById("send-network");

    function updateSendVisibility() {
      const asset = sendAssetSelect.value;
      if (asset === "card-uah") {
        sendNetworkCol.style.display = "none";
        sendNetworkSelect.disabled = true;
      } else {
        sendNetworkCol.style.display = "";
        sendNetworkSelect.disabled = false;
      }
    }
    sendAssetSelect.addEventListener("change", updateSendVisibility);
    updateSendVisibility();

    const HISTORY_KEY = "keksswap_history_v2";
    const historyContainer = document.getElementById("history-container");
    const profileStats = document.getElementById("profile-stats");

    function loadHistory() {
      try {
        return JSON.parse(localStorage.getItem(HISTORY_KEY) || "[]");
      } catch (e) {
        return [];
      }
    }

    function saveHistory(list) {
      try {
        localStorage.setItem(HISTORY_KEY, JSON.stringify(list.slice(0, 30)));
      } catch (e) {}
    }

    function renderHistory() {
      const history = loadHistory();
      if (!history.length) {
        historyContainer.innerHTML = '<div class="history-empty">' + t("history-empty") + "</div>";
      } else {
        historyContainer.innerHTML =
          '<div class="history-list">' +
          history
            .map((item) => {
              const date = new Date(item.createdAt);
              const dateStr = date.toLocaleString();
              const line = item.sendAmount + " " + item.sendAssetText + " → " + item.receiveSummaryLocalized;
              return (
                '<div class="history-item">' +
                '<div class="history-main">' +
                '<div class="history-line">' + line + "</div>" +
                '<div class="history-status">' + t("history-status-sent") + "</div>" +
                "</div>" +
                '<div class="history-meta">' + dateStr + "</div>" +
                "</div>"
              );
            })
            .join("") +
          "</div>";
      }

      const count = history.length;
      if (!count) {
        profileStats.textContent = t("profile-stats-empty");
      } else {
        const last = new Date(history[0].createdAt).toLocaleString();
        const tpl = t("profile-stats-template");
        profileStats.textContent = tpl.replace("{count}", count).replace("{last}", last);
      }
    }

    const profileNameEl = document.getElementById("profile-name");
    const profileUsernameEl = document.getElementById("profile-username");
    const contactInput = document.getElementById("contact");

    let hasTelegramUsername = false;
    let telegramUsernameText = "";

    if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
      const u = tg.initDataUnsafe.user;
      const fullName = [u.first_name, u.last_name].filter(Boolean).join(" ");
      if (fullName) profileNameEl.textContent = fullName;
      if (u.username) {
        telegramUsernameText = "@" + u.username;
        hasTelegramUsername = true;
        if (!contactInput.value) contactInput.value = telegramUsernameText;
      }
    }

    function updateProfileTexts() {
      if (hasTelegramUsername) {
        profileUsernameEl.textContent = telegramUsernameText;
      } else {
        profileUsernameEl.textContent = t("profile-username-missing");
      }
    }

    const toastEl = document.getElementById("toast");
    let toastTimeout = null;

    function showToast(textKey) {
      toastEl.textContent = t(textKey);
      toastEl.classList.add("show");
      if (toastTimeout) clearTimeout(toastTimeout);
      toastTimeout = setTimeout(() => {
        toastEl.classList.remove("show");
      }, 2600);
    }

    const form = document.getElementById("exchange-form");

    form.addEventListener("submit", (e) => {
      e.preventDefault();

      const sendAsset = sendAssetSelect.value;
      const sendAssetText = sendAssetSelect.options[sendAssetSelect.selectedIndex].text;
      const sendNetwork = sendNetworkSelect.disabled ? "" : sendNetworkSelect.value;
      const sendAmount = document.getElementById("send-amount").value.trim();

      const receiveAsset = receiveAssetSelect.value;
      const receiveAssetText = receiveAssetSelect.options[receiveAssetSelect.selectedIndex].text;
      const bankNameRaw = document.getElementById("bank-name").value;
      const bankNameText = bankNameRaw === "any"
        ? t("opt-any-bank")
        : bankNameRaw;
      const receiveNetwork =
        receiveNetworkRow.style.display === "none" ? "" : receiveNetworkSelect.value;
      const receiveDetails = document.getElementById("receive-details").value.trim();
      const contact = contactInput.value.trim();
      const comment = document.getElementById("comment").value.trim();

      if (!sendAmount || Number(sendAmount) <= 0) {
        showToast("err-amount");
        return;
      }
      if (!receiveDetails) {
        showToast("err-receive-details");
        return;
      }
      if (!contact) {
        showToast("err-contact");
        return;
      }

      let receiveSummaryLocalized = "";

      if (receiveAsset === "card-uah") {
        receiveSummaryLocalized = t("sum-card-uah").replace("{bank}", bankNameText);
      } else if (receiveAsset === "requisites-uah") {
        receiveSummaryLocalized = t("sum-requisites-uah");
      } else if (receiveAsset === "card-forex") {
        receiveSummaryLocalized = t("sum-card-forex").replace("{bank}", bankNameText);
      } else if (CRYPTO_VALUES.includes(receiveAsset)) {
        const networkText = receiveNetwork ? " (" + receiveNetwork + ")" : "";
        receiveSummaryLocalized = t("sum-crypto-template")
          .replace("{asset}", receiveAsset)
          .replace("{network}", networkText);
      }

      const order = {
        sendAsset,
        sendAssetText,
        sendNetwork,
        sendAmount,
        receiveAsset,
        receiveAssetText,
        bankName: bankNameText,
        receiveNetwork,
        receiveDetails,
        contact,
        comment,
        receiveSummaryLocalized,
        createdAt: new Date().toISOString()
      };

      if (tg && tg.sendData) {
        try {
          tg.sendData(JSON.stringify(order));
          if (tg.HapticFeedback && tg.HapticFeedback.notificationOccurred) {
            tg.HapticFeedback.notificationOccurred("success");
          }
        } catch (err) {
          console.error("Telegram sendData error", err);
        }
      }

      const history = loadHistory();
      history.unshift(order);
      saveHistory(history);
      renderHistory();

      showToast("toast-sent");
      form.reset();
      updateReceiveVisibility();
      updateSendVisibility();
    });

    const SUPPORT_LINK = "https://t.me/KeksSwapSupport";

    document.getElementById("support-open-chat").addEventListener("click", () => {
      if (tg && tg.openTelegramLink) {
        tg.openTelegramLink(SUPPORT_LINK);
      } else {
        window.open(SUPPORT_LINK, "_blank");
      }
    });

    document.getElementById("support-copy").addEventListener("click", async () => {
      const text = "@KeksSwapSupport";
      try {
        await navigator.clipboard.writeText(text);
        showToast("toast-copied");
      } catch (e) {
        showToast("toast-copied");
      }
    });

    applyTranslations(currentLang);
  </script>
</body>
</html>
